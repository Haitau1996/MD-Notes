# Linux/Unix 系统编程手册
# 基本概念
## 内核
操作系统包含两层不同的含义：
* "操作系统":  完整的软件包，包括用来管理计算机资源的核心层软件，以及附带的所有标准软件工具
* "内核":管理和分配计算机资源的核心层软件

内核的主要职责：
* 进程调度： Linux属于抢占式多任务操作系统
* 内存管理： Linux也采用了虚拟内存管理机制， 虚拟内存有下列优点
  * 进程与进程之间、进程与内核之间彼此隔离
  * 只需将进程的一部分保存在物理内存中
* 提供了文件系统
* 创建和终止进程
* 对设备的访问
* 联网
* 提供系统调用应用编程接口（API）

**内核态和用户态**：现代处理器架构一般允许CPU至少在两种不同状态下运行，即用户态和核心态。与之对应，可将虚拟内存区域划分（标记）为用户空间部分或内核空间部分。  
**进程与内核视角**：对进程来说，许多事件的发生都无法预期， 如 CPU 占用何时到期何时再次获得，自己在 RAM 中的哪个位置。而内核是运行系统的中枢所在，对于系统的一切无所不知、无所不能，为系统上所有进程的运行提供便利。因此进程的很多操作都是通过向内核发起请求来完成。

## shell
shell是一种具有特殊用途的程序，主要用于读取用户输入的命令，并执行相应的程序以响应命令（repl,Read–eval–print loop）。有时，人们也称之为命令解释器, unix 历史出现过下面几种 shell
* Bourne shell（sh）
* C shell（csh）
* Korn shell（ksh）
* Bourne again shell
* zsh: 对 Bourne shell做出了大量改进，同时加入了Bash、ksh及tcsh的某些功能。 自2019年起，macOS 的默认 Shell 已从 Bash 改为 Zsh。

shell 还可以用于 shell 脚本的解释， 因此包含很多与编程语言相关的功能。

## 用户和组
用户：
* 拥有唯一的登录名（用户名）和与之相对应的整数型用户ID（UID）
* 系统密码文件 `/etc/passwd` 中有一行记录(密码往往存在单独的 shadow 系统文件中)
  * 包括组 id
  * 主目录
  * 登陆的 shell

组：
* 每个用户组都对应这 `/etc/group` 中的一行记录，里面包含
  * 组名
  * 组 id
  * 用户列表
  
超级用户：
* 超级用户在系统中享有特权。超级用户账号的用户ID为 0，通常登录名为root。
* 通常**超级用户凌驾于系统的权限检查之上**

## 单根目录层级、目录、链接及文件
内核维护着一套单根（`/`）目录结构，以放置系统的所有文件, 所有的文件和目录都是根目录的“子孙”。  
文件类型： 文件系统内，会对文件类型进行标记，以表明其种类。
* 普通文件（纯文本文件）
* 其他文件： 设备、管道、套接字、目录以及符号链接

目录是特殊类型的文件， 数据项包括文件名以及对相应文件的引用。“文件名+引用”的组合被称为链接，目录可包含指向文件或其他目录的链接。  
**符号链接**：符号链接给文件起了一个“别号（alternative name）”。通常会以硬链接称普通链接， 软链接指符号链接。  
**文件和路径名**： 文件名可以包含除`/`和空字符（`\0`）外的所有字符,路径名是由一系列文件名组成的字符串，彼此以`/`分隔.
* 绝对路径：以“`/`”开始，指明文件相对于根目录的位置。
* 相对路径：定义了相对于进程当前工作目录的文件位置，与绝对路径名相比，相对路径名缺少了起始的“`/`”。

**文件的所有和权限** 访问文件时，系统把用户分成三类：文件的属主，文件组（group）ID相匹配的属组成员用户以及其他用户。

## 文件 I/O 模型
UNIX系统 I/O 模型最为显著的特性之一是**其 I/O 通用性概念**。I/O 系统调用使用文件描述符——（往往是数值很小的）非负整数——来指代打开的文件，由shell启动的进程会继承3个已打开的文件描述符：
* 描述符0为标准输入，指代为进程提供输入的文件
* 描述符1为标准输出，指代供进程写入输出的文件
* 描述符2为标准错误，指代供进程写入错误消息或异常通告的文件

## 进程
进程是正在执行的程序实例，在内核看来，进程是一个个实体，内核必须在它们之间共享各种计算机资源。  
进程的内存布局，一般划分为下面四个部分：
* 文本：程序的指令
* 数据： 程序使用的静态变量
* 堆：程序可从该区域动态分配额外内存
* 栈：随函数调用、返回而增减的一片内存，用于为局部变量和函数调用链接信息分配存储空间。

通过系统调用`fork()` 创建新进程，调用的进程称为父进程，新建立的被称为子进程。 进程有唯一的标识符（**PID**）和父进程的标识符(**PPID**).